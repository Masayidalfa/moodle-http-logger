{"version":3,"file":"formlogger.min.js","sources":["../src/formlogger.js"],"sourcesContent":["/* eslint-disable no-console */\ndefine([], function() {\n    return {\n        init: function() {\n            console.log(\"Form logger initialized.\");\n\n            let fieldsetData = {};\n\n            function attachFieldsetListeners(form) {\n                let fieldsetElements = form.querySelectorAll('fieldset input, fieldset select, fieldset textarea');\n                fieldsetElements.forEach(element => {\n                    if (!element.hasAttribute('data-listener-attached')) {\n                        element.addEventListener('input', function() {\n                            if (element.name) {\n                                fieldsetData[element.name] = element.value;\n                            }\n                        });\n                        element.setAttribute('data-listener-attached', 'true');\n                    }\n                });\n            }\n\n            function logFormData(form) {\n                if (!form || form.dataset.loggedOnce) return;\n                form.dataset.loggedOnce = new Date().getTime();\n                setTimeout(() => delete form.dataset.loggedOnce, 1000);\n\n                attachFieldsetListeners(form);\n\n                let formData = new FormData(form);\n                for (let key in fieldsetData) {\n                    if (fieldsetData.hasOwnProperty(key) && !formData.has(key)) {\n                        formData.append(key, fieldsetData[key]);\n                    }\n                }\n\n                formData.append('submitted_at', new Date().toISOString());\n                let url = M.cfg.wwwroot + '/local/requestlogger/log.php';\n\n                if (navigator.sendBeacon) {\n                    let blob = new Blob([new URLSearchParams(formData)], { type: 'application/x-www-form-urlencoded' });\n                    navigator.sendBeacon(url, blob);\n                } else {\n                    fetch(url, {\n                        method: 'POST',\n                        body: formData,\n                        credentials: 'same-origin'\n                    }).then(response => response.json())\n                      .then(data => console.log('âœ… Log terkirim:', data))\n                      .catch(error => console.error('âŒ Gagal mengirim log:', error));\n                }\n            }\n\n            document.addEventListener('submit', function(event) {\n                let form = event.target;\n                if (!form.method || form.method.toLowerCase() !== 'post') return;\n                logFormData(form);\n            }, true);\n\n            // ðŸ”¥ MENANGKAP FORM DI MODAL KALENDER DENGAN EVENT LISTENER LANGSUNG ðŸ”¥\n            document.addEventListener('click', function(event) {\n                let target = event.target.closest('button[data-action=\"save\"]');\n                if (!target) return;\n\n                console.log(\"ðŸŸ¢ Tombol Save kalender ditekan:\", target);\n\n                let modal = document.querySelector('.modal.show');\n                if (!modal) {\n                    console.error(\"âŒ Tidak menemukan modal yang terbuka.\");\n                    return;\n                }\n\n                let form = modal.querySelector('.mform');\n                if (!form) {\n                    console.error(\"âŒ Form tidak ditemukan dalam modal, menunggu beberapa detik...\");\n                    \n                    let waitForForm = setInterval(() => {\n                        let newModal = document.querySelector('.modal.show');\n                        if (newModal) {\n                            let newForm = newModal.querySelector('.mform');\n                            if (newForm) {\n                                console.log(\"âœ… Form ditemukan dalam modal setelah penundaan.\");\n                                clearInterval(waitForForm);\n                                logFormData(newForm);\n                            }\n                        } else {\n                            clearInterval(waitForForm);\n                        }\n                    }, 300);\n\n                    setTimeout(() => clearInterval(waitForForm), 3000);\n                } else {\n                    logFormData(form);\n                }\n            }, true);\n\n            // ðŸ” OBSERVER MODAL KALENDER TETAP AKTIF HINGGA MODAL TERTUTUP\n            function observeModal() {\n                console.log(\"ðŸ” Memulai observer modal kalender...\");\n                let observer = new MutationObserver(mutationsList => {\n                    mutationsList.forEach(mutation => {\n                        mutation.addedNodes.forEach(node => {\n                            if (node.nodeType === 1 && node.matches('.modal.show .mform')) {\n                                console.log(\"âœ… Form kalender muncul dalam modal, menambahkan listener...\");\n                                attachFieldsetListeners(node);\n                            }\n                        });\n\n                        mutation.removedNodes.forEach(node => {\n                            if (node.nodeType === 1 && node.matches('.modal.show')) {\n                                console.log(\"ðŸ›‘ Modal ditutup, menghentikan observer.\");\n                                observer.disconnect();\n                            }\n                        });\n                    });\n                });\n\n                observer.observe(document.body, { childList: true, subtree: true });\n            }\n\n            document.addEventListener('click', function(event) {\n                let newEventButton = event.target.closest('button[data-action=\"new-event-button\"]');\n                if (!newEventButton) return;\n\n                console.log(\"ðŸ“Œ Tombol 'New Event' ditekan, memantau modal...\");\n                observeModal();\n            });\n\n            // ðŸ›  MENCEGAH FETCH LOGGER BERLEBIHAN\n            (function() {\n                let originalFetch = window.fetch;\n                window.fetch = function(url, options) {\n                    console.log(\"ðŸ“¡ AJAX POST ke:\", url);\n                    return originalFetch.apply(this, arguments);\n                };\n            })();\n        }\n    };\n});\n"],"names":["define","init","console","log","fieldsetData","attachFieldsetListeners","form","querySelectorAll","forEach","element","hasAttribute","addEventListener","name","value","setAttribute","logFormData","dataset","loggedOnce","Date","getTime","setTimeout","formData","FormData","key","hasOwnProperty","has","append","toISOString","url","M","cfg","wwwroot","navigator","sendBeacon","blob","Blob","URLSearchParams","type","fetch","method","body","credentials","then","response","json","data","catch","error","document","event","target","toLowerCase","closest","modal","querySelector","waitForForm","setInterval","newModal","newForm","clearInterval","observer","MutationObserver","mutationsList","mutation","addedNodes","node","nodeType","matches","removedNodes","disconnect","observe","childList","subtree","observeModal","originalFetch","window","options","apply","this","arguments"],"mappings":"AACAA,wCAAO,IAAI,iBACA,CACHC,KAAM,WACFC,QAAQC,IAAI,gCAERC,aAAe,YAEVC,wBAAwBC,MACNA,KAAKC,iBAAiB,sDAC5BC,SAAQC,UAChBA,QAAQC,aAAa,4BACtBD,QAAQE,iBAAiB,SAAS,WAC1BF,QAAQG,OACRR,aAAaK,QAAQG,MAAQH,QAAQI,UAG7CJ,QAAQK,aAAa,yBAA0B,qBAKlDC,YAAYT,UACZA,MAAQA,KAAKU,QAAQC,WAAY,OACtCX,KAAKU,QAAQC,YAAa,IAAIC,MAAOC,UACrCC,YAAW,WAAad,KAAKU,QAAQC,YAAY,KAEjDZ,wBAAwBC,UAEpBe,SAAW,IAAIC,SAAShB,UACvB,IAAIiB,OAAOnB,aACRA,aAAaoB,eAAeD,OAASF,SAASI,IAAIF,MAClDF,SAASK,OAAOH,IAAKnB,aAAamB,MAI1CF,SAASK,OAAO,gBAAgB,IAAIR,MAAOS,mBACvCC,IAAMC,EAAEC,IAAIC,QAAU,kCAEtBC,UAAUC,WAAY,KAClBC,KAAO,IAAIC,KAAK,CAAC,IAAIC,gBAAgBf,WAAY,CAAEgB,KAAM,sCAC7DL,UAAUC,WAAWL,IAAKM,WAE1BI,MAAMV,IAAK,CACPW,OAAQ,OACRC,KAAMnB,SACNoB,YAAa,gBACdC,MAAKC,UAAYA,SAASC,SAC1BF,MAAKG,MAAQ3C,QAAQC,IAAI,kBAAmB0C,QAC5CC,OAAMC,OAAS7C,QAAQ6C,MAAM,wBAAyBA,SAIjEC,SAASrC,iBAAiB,UAAU,SAASsC,WACrC3C,KAAO2C,MAAMC,OACZ5C,KAAKiC,QAAwC,SAA9BjC,KAAKiC,OAAOY,eAChCpC,YAAYT,SACb,GAGH0C,SAASrC,iBAAiB,SAAS,SAASsC,WACpCC,OAASD,MAAMC,OAAOE,QAAQ,kCAC7BF,OAAQ,OAEbhD,QAAQC,IAAI,mCAAoC+C,YAE5CG,MAAQL,SAASM,cAAc,mBAC9BD,kBACDnD,QAAQ6C,MAAM,6CAIdzC,KAAO+C,MAAMC,cAAc,aAC1BhD,KAmBDS,YAAYT,UAnBL,CACPJ,QAAQ6C,MAAM,sEAEVQ,YAAcC,aAAY,SACtBC,SAAWT,SAASM,cAAc,kBAClCG,SAAU,KACNC,QAAUD,SAASH,cAAc,UACjCI,UACAxD,QAAQC,IAAI,mDACZwD,cAAcJ,aACdxC,YAAY2C,eAGhBC,cAAcJ,eAEnB,KAEHnC,YAAW,IAAMuC,cAAcJ,cAAc,SAIlD,GA0BHP,SAASrC,iBAAiB,SAAS,SAASsC,OACnBA,MAAMC,OAAOE,QAAQ,4CAG1ClD,QAAQC,IAAI,+DA1BZD,QAAQC,IAAI,6CACRyD,SAAW,IAAIC,kBAAiBC,gBAChCA,cAActD,SAAQuD,WAClBA,SAASC,WAAWxD,SAAQyD,OACF,IAAlBA,KAAKC,UAAkBD,KAAKE,QAAQ,wBACpCjE,QAAQC,IAAI,+DACZE,wBAAwB4D,UAIhCF,SAASK,aAAa5D,SAAQyD,OACJ,IAAlBA,KAAKC,UAAkBD,KAAKE,QAAQ,iBACpCjE,QAAQC,IAAI,4CACZyD,SAASS,uBAMzBT,SAASU,QAAQtB,SAASR,KAAM,CAAE+B,WAAW,EAAMC,SAAS,IAQ5DC,sBAKIC,cAAgBC,OAAOrC,MAC3BqC,OAAOrC,MAAQ,SAASV,IAAKgD,gBACzB1E,QAAQC,IAAI,mBAAoByB,KACzB8C,cAAcG,MAAMC,KAAMC"}